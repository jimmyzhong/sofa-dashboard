<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" >
<head>
	<th:block th:include="include :: header('新增类别')" />
</head>
<body class="white-bg">
<div class="wrapper wrapper-content animated fadeInRight ibox-content">
	<form class="form-horizontal m" id="form-shop-category-edit" th:object="${goodsCategory}">
		<input id="id" name="id" type="hidden" th:field="*{id}" />
		<input id="parentId" name="parentId" type="hidden" th:field="*{parentId}"/>
		<div class="form-group tc">
			<label class="col-sm-3 control-label">图标：</label>
			<div class="col-sm-8">
				<img id="imageFile_img" class="img-circle img-lg" th:src="${goodsCategory.icon}">
				<label>
					<input onchange ="uploadImg()" type="file" class="" id="imageFile" accept="image/*"/>
					<input name="icon" id="icon"  type="hidden"/>
				</label>
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-3 control-label">类别名称：</label>
			<div class="col-sm-8">
				<input class="form-control" type="text" name="name" id="name" th:field="*{name}" required>
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-3 control-label"></label>
			<div class="col-sm-8">
				<button type="button" class="btn btn-w-m btn-primary" onclick="submitHandler()">提交</button>
			</div>
		</div>

	</form>
</div>
<th:block th:include="include :: footer" />
<script type="text/javascript" th:inline="javascript">
	var prefix = ctx + "ext/shop/category";
	$("#form-shop-category-edit").validate({
		onkeyup: false,
		focusCleanup: true
	});
	function submitHandler() {
		if(!$("#imageUrl").val()){
			$.modal.alertWarning("类别图标不能为空");
			return;
		}
		if ($.validate.form()) {
			var data = $("#form-shop-category-edit").serializeArray();
			// data.push({"name": "parentId", "value": $("#parentIds").val()?$("#parentIds").val():0});
			$.operate.save(prefix + "/edit", data);
		}

	}
	function uploadImg(){
		var formdata = new FormData();
		formdata.append("file", $("#imageFile")[0].files[0]);
		$.ajax({
			url: ctx + "ext/shop/oss/upload",
			data: formdata,
			type: "post",
			processData: false,
			contentType: false,
			success: function (result) {
				$("#icon").val(result.data.pictureUrl)
				$("#imageFile_img").attr("src",result.data.pictureUrl)
			}
		})
	}
</script>
</body>
</html>
